<!DOCTYPE html>
<html>
<head>
    <title>Socket.IO Test</title>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <h1>Socket.IO Connection Test</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>
    <button onclick="sendTestMessage()">Send Test Message</button>
    <button onclick="sendPing()">Send Ping</button>

    <script>
        const statusDiv = document.getElementById('status');
        const messagesDiv = document.getElementById('messages');

        // Connect to Socket.IO server
        const socket = io('http://localhost:4001');

        socket.on('connect', function() {
            statusDiv.innerHTML = 'Connected to Socket.IO server';
            statusDiv.style.color = 'green';
            console.log('Connected to Socket.IO server with ID:', socket.id);
        });

        socket.on('message', function(message) {
            const messageElement = document.createElement('div');
            messageElement.innerHTML = `<strong>Received:</strong> ${JSON.stringify(message, null, 2)}`;
            messagesDiv.appendChild(messageElement);
        });

        socket.on('disconnect', function() {
            statusDiv.innerHTML = 'Connection closed';
            statusDiv.style.color = 'red';
        });

        socket.on('error', function(error) {
            statusDiv.innerHTML = 'Connection error: ' + error;
            statusDiv.style.color = 'red';
        });

        function sendTestMessage() {
            const testMessage = {
                type: 'api_request',
                requestId: 'test-' + Date.now(),
                payload: {
                    api: 'test.api.call',
                    data: { key: 'value' }
                }
            };

            socket.emit('message', testMessage);

            const messageElement = document.createElement('div');
            messageElement.innerHTML = `<strong>Sent:</strong> ${JSON.stringify(testMessage, null, 2)}`;
            messageElement.style.color = 'blue';
            messagesDiv.appendChild(messageElement);
        }

        function sendPing() {
            socket.emit('message', { type: 'ping' });

            const messageElement = document.createElement('div');
            messageElement.innerHTML = '<strong>Sent:</strong> ping';
            messageElement.style.color = 'blue';
            messagesDiv.appendChild(messageElement);
        }
    </script>
</body>
</html>